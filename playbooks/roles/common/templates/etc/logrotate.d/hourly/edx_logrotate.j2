{{ COMMON_LOG_DIR }}/*/edx.log {
  create
  compress
  copytruncate
  delaycompress
  dateext
  dateformat -%Y%m%d-%s
  missingok
  notifempty
  daily
  rotate 90
  size 1M
  postrotate
    /usr/bin/killall -HUP rsyslogd
    {% if COMMON_AWS_SYNC -%}
    for dir in `ls {{ COMMON_LOG_DIR }}`; do
        if echo $dir | grep -qv tracking; then
            {{ aws_s3_sync_script }} -d {{ COMMON_LOG_DIR }}/$dir -b "edx-{{ COMMON_ENVIRONMENT }}-{{ COMMON_DEPLOYMENT }}/logs/application"
        fi
    done
    {% endif -%}
  endscript
}
